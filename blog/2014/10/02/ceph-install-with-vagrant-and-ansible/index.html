
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>ä½¿ç”¨Vagrantå’ŒAnsibleæ­å»ºCephç¯å¢ƒ - Hacker and Geeker's Way</title>
    <meta name="author" content="èµµèŠæ˜">
    
	<meta name="description" content="ä½¿ç”¨Vagrantå’ŒAnsibleéƒ¨ç½²Cephç¯å¢ƒ">
	<meta name="keywords" content="vagrant,ansible,ceph">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Hacker and Geeker's Way" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/slackey.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/fjalla_one.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/amethysta.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/css_grid.css' rel='stylesheet' type='text/css'>
	  <script src="https://cdn.staticfile.org/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    <link href="https://cdn.staticfile.org/semantic-ui/0.10.0/css/semantic.min.css" rel="stylesheet" type="text/css">

<script src="https://cdn.staticfile.org/semantic-ui/0.10.0/javascript/semantic.min.js"></script>
<script src="/javascripts/monthly_archive.js"></script>

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
<div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker's Way
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a href="http://stackoverflow.com/users//1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
  
  <!-- wechat -->
  <li class="wechat">
  <a href="#" class="wechat" title="Wechat">
    <i class="wechat-qr"></i>
  </a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

	<div id="toload">
		<div id="content">
			<div class="inner">
	<article class="post">
	<h2 class="title">ä½¿ç”¨Vagrantå’ŒAnsibleæ­å»ºCephç¯å¢ƒ</h2>
	<div class="entry-content"><p><img src="/images/post/2014-9/ceph-install.jpg"></p>

<h2><a href="http://ceph.com/">Ceph</a>ç®€ä»‹</h2>

<p>Cephæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ‰©å±•çš„åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨æ¡†æ¶å’Œæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„é¡¹ç›®ã€‚</p>

<p>ä½†æ˜¯Cephçš„ç¯å¢ƒæ­å»ºèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæœ€ç®€å•çš„ç¯å¢ƒä¹Ÿéœ€è¦2å°VM(è™šæ‹Ÿæœºï¼Œ1å°åšmonå’Œosdï¼Œå¦å¤–ä¸€å°åšgateway)ï¼Œè€Œä¸”æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸Šé¢çš„æŒ‡å—è¿›è¡Œå®‰è£…ï¼Œç»å¸¸æŠ¥å„ç§è«åå…¶å¦™çš„é—®é¢˜ï¼Œç°åœ¨ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥è¿›è¡ŒCephç¯å¢ƒçš„æ­å»ºã€‚ä¸‹é¢å…ˆä»‹ç»å‡ ä¸ªè¦ç”¨åˆ°çš„å·¥å…·ã€‚</p>

<!--more-->


<h2><a href="https://www.vagrantup.com/">Vagrant</a></h2>

<p><img src="/images/post/2014-9/vagrant.png"></p>

<p>ä»¥å‰ä½¿ç”¨VMæƒ…å†µæ˜¯è¿™æ ·çš„:</p>

<ul>
<li>ä¸‹è½½æ“ä½œç³»ç»Ÿçš„isoé•œåƒ</li>
<li>é€šè¿‡VMç®¡ç†å·¥å…·(VMWareï¼ŒVirtualBoxç­‰)å°†isoé•œåƒè½¬æ¢ä¸ºVM</li>
<li>ç™»é™†åˆ°VMè¿›è¡Œæ“ä½œ</li>
</ul>


<p>æ•´ä¸ªè¿‡ç¨‹å¤æ‚è€Œä¸”æ¼«é•¿ï¼Œä½†æ˜¯ä½¿ç”¨äº†Vagrantä¹‹åå°±éå¸¸æ–¹ä¾¿äº†ï¼Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æå®šVMçš„å®‰è£…ï¼Œsshåˆ°VMä¹Ÿæ— éœ€è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰VMçš„çŠ¶æ€ç­‰ã€‚</p>

<h3>Box</h3>

<p>vagranté€šè¿‡boxæ¥ç”ŸæˆVMï¼Œboxå¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªåˆ¶ä½œå¥½çš„VMï¼Œè¿™æ„å‘³ç€ä½ æ­å»ºå®Œè‡ªå·±çš„å¼€å‘ç¯å¢ƒåï¼Œä¹Ÿå¯ä»¥å°†å…¶åˆ¶ä½œæˆä¸€ä¸ªboxï¼Œä¾›å›¢é˜Ÿå…¶ä»–æˆå‘˜ä½¿ç”¨ã€‚</p>

<p>boxçš„å®¹é‡éå¸¸å°ï¼Œæ¯”å¦‚Ubuntu12.04çš„ä¸€ä¸ªisoé•œåƒä¸€èˆ¬è¦500å¤šMï¼Œåˆ¶ä½œæˆVMå¯èƒ½è¦10Gå·¦å³ï¼Œè€Œä¸€ä¸ªubuntu12.04çš„boxåªæœ‰300å¤šMã€‚Vagrantçš„boxå¯ä»¥åœ¨<a href="https://vagrantcloud.com/discover/featured">è¿™é‡Œ</a>ä¸‹è½½ï¼Œé™¤äº†æœ‰å„ç§OS(ubuntu, windosw, CentOSç­‰)çš„VMå¤–ï¼Œè¿˜æœ‰Virtualboxå’ŒVMWareå„è‡ªå¯¹åº”çš„boxï¼Œä¸è¿‡è¦ä½¿ç”¨VMWareçš„boxï¼Œéœ€è¦å®‰è£…æ’ä»¶å’Œåˆ°è´­ä¹°ç›¸å…³çš„<a href="https://www.vagrantup.com/VMware">License</a>ï¼Œæ¯•ç«ŸVMWareä¸æ˜¯å…è´¹çš„è½¯ä»¶ã€‚</p>

<p>ä¸‹è½½äº†boxåï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥æ·»åŠ boxäº†ï¼Œå¦‚æœç›´æ¥è¾“å…¥boxåç§°å¹¶å‘ç°æœ¬åœ°æ²¡æœ‰boxçš„è¯ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½boxæ–‡ä»¶ã€‚(<code>PS: Vagranté»˜è®¤ä½¿ç”¨Virtualboxä½œä¸ºè™šæ‹Ÿå™¨è½¯ä»¶ï¼Œæ‰€ä»¥åœ¨å®‰è£…Vagrantè¿˜éœ€è¦å…ˆå®‰è£…Virtualboxã€‚</code>)</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>//æ·»åŠ æœ¬åœ°boxæ–‡ä»¶
</span><span class='line'><span class="nv">$ </span>vagrant box add /your/box/path/xxx.box
</span><span class='line'>//æ·»åŠ æŒ‡å®šåç§°çš„boxï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨ä¸‹è½½boxæ–‡ä»¶
</span><span class='line'><span class="nv">$ </span>vagrant box add hashicorp/precise32
</span><span class='line'>//åˆ—å‡ºæ‰€æœ‰çš„box
</span><span class='line'><span class="nv">$ </span>vagrant box list
</span></code></pre></td></tr></table></div></figure>


<h3>VagrantåŸºæœ¬æ“ä½œ</h3>

<p>Vagrantçš„æ“ä½œéå¸¸ç®€å•ï¼Œç°åœ¨ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ“ä½œæŒ‡ä»¤ã€‚(<code>PS: ä¸‹é¢çš„å¤§éƒ¨åˆ†å‘½ä»¤åé¢å¯ä»¥è·ŸVMåç§°ï¼Œä¸è·Ÿçš„è¯æ˜¯å¯¹æ‰€æœ‰çš„VMè¿›è¡Œæ“ä½œã€‚</code>)</p>

<ul>
<li>vagrant status: å±•ç¤ºVMçš„ä¿¡æ¯ã€‚</li>
<li>vagrant up: å¯åŠ¨VMã€‚</li>
<li>vagrant ssh [VM]: sshåˆ°æŸä¸ªVMä¸Šï¼Œæ— éœ€è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</li>
<li>vagrant halt: å…³é—­VMã€‚</li>
<li>vagrant destroy: é”€æ¯VMï¼Œå¦‚æœä½ çš„VMè¢«ä½ ç©æ®‹äº†ï¼Œé”€æ¯å®ƒç„¶åé‡æ–°å¯åŠ¨ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå¾ˆæ–¹ä¾¿ã€‚</li>
</ul>


<h3>Vagrantå…±äº«</h3>

<p>ä½¿ç”¨<code>vagrant ssh</code>åˆ°VMåï¼Œå¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹æœ‰ä¸ª<code>/vagrant</code>æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ˜¯VMå’Œå·¥ç¨‹é—´çš„å…±äº«ç›®å½•ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å­˜æ”¾ä¸œè¥¿ï¼Œå¯ä»¥åœ¨å­˜æ”¾Vagrantfileçš„ç›®å½•é‡Œé¢çœ‹åˆ°ï¼Œåä¹‹äº¦ç„¶ï¼Œåœ¨VMé‡Œé¢ä¹Ÿå¯ä»¥è¯»å–åˆ°å·¥ç¨‹ä¸‹çš„æ–‡ä»¶ã€‚</p>

<h3>Vagrantfile</h3>

<p>åˆå§‹åŒ–vagrantå·¥ç¨‹åå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>Vagrantfile</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯é…ç½®VMçš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;hashicorp/precise64&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">define</span> <span class="ss">:rgw</span> <span class="k">do</span> <span class="o">|</span><span class="n">rgw</span><span class="o">|</span>
</span><span class='line'>    <span class="n">rgw</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.42.2&quot;</span>
</span><span class='line'>    <span class="n">rgw</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">host_name</span> <span class="o">=</span> <span class="s2">&quot;ceph-rgw&quot;</span>
</span><span class='line'>    <span class="n">rgw</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span class='line'>      <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&quot;modifyVM&quot;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&quot;--memory&quot;</span><span class="p">,</span> <span class="s2">&quot;192&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">rgw</span><span class="o">.</span><span class="n">VM</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:VMware_fusion</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
</span><span class='line'>      <span class="n">v</span><span class="o">.</span><span class="n">VMx</span><span class="o">[</span><span class="s1">&#39;memsize&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;192&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªVagrantfileæŒ‡å®šäº†boxçš„åç§°ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªåç§°ä¸º<code>rgw</code>çš„VMï¼ŒæŒ‡å®šäº†VMçš„ipã€hostnameã€å†…å­˜å¤§å°ã€‚</p>

<p>å…³äºvagrantå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a href="https://www.vagrantup.com/">vagrantå®˜ç½‘</a>ã€‚</p>

<h2><a href="http://www.ansible.com/home">Ansible</a></h2>

<p><img src="/images/post/2014-9/ansible.jpg"></p>

<p>Ansibleæ˜¯ä¸€ä¸ªå¼€æºçš„è¿œç¨‹æœºå™¨ç®¡ç†è½¯ä»¶ï¼Œå¯ä»¥æ‰¹é‡æ“ä½œå¤šå°è¿œç¨‹æœåŠ¡å™¨ã€‚(<code>PS: Ansibleåªé€‚åˆæ“ä½œLinuxå’ŒUnixæœºå™¨ï¼Œå¦‚æœæ˜¯Windowsç³»ç»Ÿæ˜¯ä¸å¯ä»¥çš„ã€‚</code>)</p>

<h3>å®‰è£…</h3>

<p>è¦å®‰è£…Ansibleéœ€è¦å…ˆå®‰è£…Python2.6/7ï¼Œç„¶åå¯ä»¥é€šè¿‡easy_installæˆ–pipè¿›è¡Œä¸‹è½½å®‰è£…ã€‚</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo esay_install ansible
</span><span class='line'><span class="c"># or</span>
</span><span class='line'>sudo pip install ansible
</span></code></pre></td></tr></table></div></figure>


<h3>ä½¿ç”¨ç¤ºä¾‹</h3>

<p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºä¸€ä¸ªhostsæ–‡ä»¶ï¼Œhostsæ ¼å¼å¦‚ä¸‹:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># hosts</span>
</span><span class='line'><span class="o">[</span>ceph<span class="o">]</span>
</span><span class='line'>192.168.42.2
</span><span class='line'>192.168.42.101
</span><span class='line'>192.168.42.201
</span></code></pre></td></tr></table></div></figure>


<p>å¯ä»¥çœ‹åˆ°hostsæ–‡ä»¶é‡Œé¢æœ‰å‡ ä¸ªè¿œç¨‹æœºå™¨çš„ip(è¿™é‡Œæ˜¯è™šæ‹Ÿæœº)ï¼Œè¿œç¨‹æœºå™¨å¯ä»¥åˆ†ç»„ï¼Œé€šè¿‡ä¸­æ‹¬å·é‡Œé¢çš„ç»„åæ¥åˆ’åˆ†ã€‚</p>

<p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œç®€å•çš„å‘½ä»¤ã€‚</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ansible all -a <span class="s1">&#39;who&#39;</span>
</span><span class='line'>ceph-mon0 | success | <span class="nv">rc</span><span class="o">=</span>0 &gt;&gt;
</span><span class='line'>ceph     pts/0        2014-10-02 08:54 <span class="o">(</span>192.168.42.60<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>ceph-osd0 | success | <span class="nv">rc</span><span class="o">=</span>0 &gt;&gt;
</span><span class='line'>ceph     pts/0        2014-10-02 08:54 <span class="o">(</span>192.168.42.60<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>ceph-osd1 | success | <span class="nv">rc</span><span class="o">=</span>0 &gt;&gt;
</span><span class='line'>ceph     pts/0        2014-10-02 08:54 <span class="o">(</span>192.168.42.60<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»è¾“å‡ºä¿¡æ¯ä¸Šå¯ä»¥çœ‹åˆ°è¿™å‡ å°è¿œç¨‹æœºå™¨éƒ½æˆåŠŸæ‰§è¡Œäº†<code>who</code>å‘½ä»¤ï¼Œä¸è¿‡å¦‚æœè¦æˆåŠŸæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œè¿˜éœ€è¦å…ˆåœ¨æ‰§è¡Œæœºå’Œè¿œç¨‹æœºä¸Šé¢è®¾ç½®æ— å¯†ç sshè¿æ¥ã€‚</p>

<h3>æ— å¯†ç sshè¿æ¥</h3>

<p>å‡è®¾æœ‰2å°æœºå™¨ï¼Œæœºå™¨Aå’Œæœºå™¨Bï¼Œç°åœ¨æƒ³è®©æœºå™¨A<code>ssh</code>æœºå™¨Bçš„æ—¶å€™ä¸éœ€è¦è¾“å…¥ç”¨æˆ·å’Œå¯†ç ï¼Œæ“ä½œå¦‚ä¸‹ã€‚</p>

<ul>
<li>åœ¨æœºå™¨Bä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶é…ç½®å¥½ï¼Œä¸‹é¢å‘½ä»¤çš„<code>username</code>æŒ‡è‡ªå·±è¦åˆ›å»ºçš„ç”¨æˆ·åã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo useradd -d /home/<span class="o">{</span>username<span class="o">}</span> -m <span class="o">{</span>username<span class="o">}</span>
</span><span class='line'><span class="nv">$ </span>sudo passwd <span class="o">{</span>username<span class="o">}</span>
</span><span class='line'><span class="c"># è¾“å…¥å¯†ç </span>
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;{username} ALL = (root) NOPASSWD:ALL&quot;</span> | sudo tee /etc/sudoers.d/<span class="o">{</span>username<span class="o">}</span>
</span><span class='line'><span class="nv">$ </span>sudo chmod 0440 /etc/sudoers.d/<span class="o">{</span>username<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨æœºå™¨Aä¸Šç”Ÿæˆå¯†é’¥ï¼Œå¹¶å‘é€ç»™æœºå™¨Bã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ssh-keygen
</span><span class='line'>
</span><span class='line'>Generating public/private key pair.
</span><span class='line'>Enter file in which to save the key <span class="o">(</span>/ceph-admin/.ssh/id_rsa<span class="o">)</span>:
</span><span class='line'>Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:
</span><span class='line'>Enter same passphrase again:
</span><span class='line'>Your identification has been saved in /ceph-admin/.ssh/id_rsa.
</span><span class='line'>Your public key has been saved in /ceph-admin/.ssh/id_rsa.pub.
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>ssh-copy-id <span class="o">{</span>username<span class="o">}</span>@<span class="o">{</span>æœºå™¨B<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åˆ°è¿™é‡Œå°±å¯ä»¥ä¸ç”¨è¾“å…¥å¯†ç è¿›è¡Œsshäº†ï¼Œå¦‚æœæƒ³è¿ç”¨æˆ·åä¹Ÿä¸æƒ³è¾“å…¥çš„è¯ï¼Œéœ€è¦æœºå™¨Aåœ¨<code>.ssh</code>æ–‡ä»¶ä¸‹åˆ›å»ºä¸€ä¸ª<code>config</code>æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Host æœºå™¨B
</span><span class='line'>   Hostname æœºå™¨B
</span><span class='line'>   User <span class="o">{</span>username<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>playbook</h3>

<p>ansibleè¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªplaybookè„šæœ¬è¿›è¡Œè¿œç¨‹æœºå™¨çš„æ“ä½œï¼Œplaybookçš„ç¤ºä¾‹å¦‚ä¸‹:</p>

<figure class='code'><figcaption><span>playbook.yml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># playbook.yml</span>
</span><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">all</span>
</span><span class='line'>  <span class="l-Scalar-Plain">remote_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ceph</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">whoami</span>
</span><span class='line'>      <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="s">&#39;whoami</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">whoami.rst&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ›å»ºå®Œplaybookæ–‡ä»¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœã€‚</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ansible-playbook playbook.yml
</span><span class='line'>
</span><span class='line'>PLAY <span class="o">[</span>all<span class="o">]</span> ********************************************************************
</span><span class='line'>
</span><span class='line'>GATHERING FACTS ***************************************************************
</span><span class='line'>ok: <span class="o">[</span>ceph-mon0<span class="o">]</span>
</span><span class='line'>ok: <span class="o">[</span>ceph-osd1<span class="o">]</span>
</span><span class='line'>ok: <span class="o">[</span>ceph-osd0<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>TASK: <span class="o">[</span>whoami<span class="o">]</span> ****************************************************************
</span><span class='line'>changed: <span class="o">[</span>ceph-mon0<span class="o">]</span>
</span><span class='line'>changed: <span class="o">[</span>ceph-osd0<span class="o">]</span>
</span><span class='line'>changed: <span class="o">[</span>ceph-osd1<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>PLAY RECAP ********************************************************************
</span><span class='line'>ceph-mon0                  : <span class="nv">ok</span><span class="o">=</span>2    <span class="nv">changed</span><span class="o">=</span>1    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>ceph-osd0                  : <span class="nv">ok</span><span class="o">=</span>2    <span class="nv">changed</span><span class="o">=</span>1    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>ceph-osd1                  : <span class="nv">ok</span><span class="o">=</span>2    <span class="nv">changed</span><span class="o">=</span>1    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ—¶å¯ä»¥åœ¨è¿œç¨‹æœºå™¨çš„ç”¨æˆ·ç›®å½•ä¸Šå¯ä»¥çœ‹åˆ°æ–°äº§ç”Ÿäº†ä¸€ä¸ª<code>whoami.rst</code>çš„æ–‡ä»¶ã€‚</p>

<p>å…³äºansibleå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a href="http://docs.ansible.com/">ansibleçš„æ–‡æ¡£</a>ã€‚</p>

<h2><a href="https://github.com/ceph/ceph-ansible">Ceph-ansible</a></h2>

<p>è¿™ä¸ªgithubé¡¹ç›®ä¸»è¦æ˜¯åˆ©ç”¨äº†ä¸Šé¢ä»‹ç»çš„2ä¸ªå·¥å…·ï¼Œä½¿ç”¨vagrantæ¥åˆ›å»ºcephéœ€è¦çš„æœåŠ¡å™¨VMï¼Œç„¶åå°†cephçš„ç¯å¢ƒæ­å»ºé€šè¿‡ansibleçš„playbookè„šæœ¬æ‰§è¡Œã€‚</p>

<h3>æ‰§è¡Œæ­¥éª¤</h3>

<ul>
<li>ä¸‹è½½ceph-ansibleé¡¹ç›®;</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git clone https://github.com/ceph/ceph-ansible.git
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä¸€è¡Œå‘½ä»¤å°±å¯ä»¥å®Œæˆç¯å¢ƒæ­å»ºï¼Œå®Œæˆåcephçš„ç¯å¢ƒæ˜¯: 3ä¸ªmonï¼Œ3ä¸ªosdï¼Œ1ä¸ªrgw;</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vagrant up
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>mon0                       : <span class="nv">ok</span><span class="o">=</span>16   <span class="nv">changed</span><span class="o">=</span>11   <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>mon1                       : <span class="nv">ok</span><span class="o">=</span>16   <span class="nv">changed</span><span class="o">=</span>10   <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>mon2                       : <span class="nv">ok</span><span class="o">=</span>16   <span class="nv">changed</span><span class="o">=</span>11   <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>osd0                       : <span class="nv">ok</span><span class="o">=</span>19   <span class="nv">changed</span><span class="o">=</span>7    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>osd1                       : <span class="nv">ok</span><span class="o">=</span>19   <span class="nv">changed</span><span class="o">=</span>7    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>osd2                       : <span class="nv">ok</span><span class="o">=</span>19   <span class="nv">changed</span><span class="o">=</span>7    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span><span class='line'>rgw                        : <span class="nv">ok</span><span class="o">=</span>20   <span class="nv">changed</span><span class="o">=</span>17   <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>



</div>

<div class="meta">
</div>
</article>
  <section id="appreciates">
    <center>
	    <h2>èµèµ</h2>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥è½¬ç‚¹ ETH ç»™æˆ‘å–å’–å•¡ğŸ˜Œï¼Œé’±åŒ…äºŒç»´ç ï¼š</h4>
      <span>0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</span>
      <img src="/images/my_eth_qrcode.png" alt="qrcode" width="250" >
    </center>
  </section>
	
		<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

	
	
	<section id="comment">
	    <h2 class="title">Comments</h2>
	    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
	</section>
	
</div>

	    </div>
	    <footer id="footer">
	    <div style="display:inline">
    Copyright &copy; 2018

    èµµèŠæ˜
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


	    </footer>
	    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'zhaozhiming';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://zhaozhiming.github.io/blog/2014/10/02/ceph-install-with-vagrant-and-ansible/';
        var disqus_url = 'http://zhaozhiming.github.io/blog/2014/10/02/ceph-install-with-vagrant-and-ansible/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




	</div>
	
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
