
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>åœ¨Ubuntu12.04ä¸Šå®‰è£…Ceph Calamari - Hacker and Geeker's Way</title>
    <meta name="author" content="èµµèŠæ˜">
    
	<meta name="description" content="åœ¨Ubuntu12.04ä¸Šå®‰è£…Ceph Calamari">
	<meta name="keywords" content="calamari,ceph,ubuntu">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Hacker and Geeker's Way" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/slackey.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/fjalla_one.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/amethysta.css' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/css_grid.css' rel='stylesheet' type='text/css'>
	<script src="http://cdn.staticfile.org/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    <link href="http://cdn.staticfile.org/semantic-ui/0.10.0/css/semantic.min.css" rel="stylesheet" type="text/css">

<script src="http://cdn.staticfile.org/semantic-ui/0.10.0/javascript/semantic.min.js"></script>
<script src="/javascripts/monthly_archive.js"></script>
    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
<div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker's Way
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a href="http://stackoverflow.com/users//1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
  
  <!-- wechat -->
  <li class="wechat">
  <a href="#" class="wechat" title="Wechat">
    <i class="wechat-qr"></i>
  </a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

	<div id="toload">
		<div id="content">
			<div class="inner">
	<article class="post">
	<h2 class="title">åœ¨Ubuntu12.04ä¸Šå®‰è£…Ceph Calamari</h2>
	<div class="entry-content"><p><img src="/images/post/2014-10/calamari.png"></p>

<p>Calamariæ˜¯<a href="http://ceph.com/">Ceph</a>çš„ä¸€ä¸ªç›‘æ§å’Œç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€äº›å®šä¹‰å¥½çš„REST APIã€‚CalamariåŒ…æ‹¬æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æ˜¯ä½¿ç”¨Pythonçš„webæ¡†æ¶<a href="https://www.djangoproject.com/">Django</a>å¼€å‘çš„ï¼Œæä¾›äº†ä¾›å®¢æˆ·ç«¯è°ƒç”¨çš„REST APIæ¥å£ã€‚å®¢æˆ·ç«¯ä½¿ç”¨äº†<a href="http://nodejs.org/">NodeJS</a>,<a href="https://angularjs.org/">AngularJS</a>,<a href="http://getbootstrap.com/">Bootstrap3</a>ï¼Œæ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹éƒ¨ç½²æ›´æ–°ï¼Œå…¶ç•Œé¢ååˆ†ç®€æ´æ¸…æ™°ï¼Œå‡ ä¹æ¶µç›–äº†æ‰€æœ‰ç›‘æ§è¦æ±‚ã€‚</p>

<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹Calamariåœ¨Ubuntuä¸Šé¢çš„å®‰è£…è¿‡ç¨‹ã€‚</p>

<!--more-->


<h2>ç¯å¢ƒå‡†å¤‡</h2>

<ul>
<li>å®‰è£…VitrualBoxå’ŒVagrantï¼ŒVagrantçš„ä½¿ç”¨å¯ä»¥å‚ç…§æˆ‘ä¹‹å‰çš„blogâ€”â€”<a href="http://zhaozhiming.github.io/blog/2014/10/02/ceph-install-with-vagrant-and-ansible">ä½¿ç”¨Vagrantå’ŒAnsibleæ­å»ºCephç¯å¢ƒ</a>ã€‚</li>
<li>ä¸‹è½½ubuntu12.04çš„boxæ–‡ä»¶â€”â€”<a href="https://vagrantcloud.com/discover/featured">boxæ–‡ä»¶ä¸‹è½½åœ°å€</a>ï¼Œæˆ‘ä»¬åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…calamariï¼Œä¸æ±¡æŸ“æˆ‘ä»¬çš„æœ¬æœºç¯å¢ƒã€‚</li>
</ul>


<h2>ç”ŸæˆCalamariå®‰è£…æ–‡ä»¶</h2>

<h3>ç”Ÿæˆserverå®‰è£…æ–‡ä»¶</h3>

<ul>
<li>ä¸‹è½½calamariå·¥ç¨‹</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir calamari-node
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/ceph/calamari.git
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/ceph/Diamond.git
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä½¿ç”¨vagrantç”Ÿæˆserverå®‰è£…æ–‡ä»¶</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari/vagrant/precise-build
</span><span class='line'><span class="c"># é¦–å…ˆè¦ä¿è¯ä½ çš„vagrantå·²ç»å¯¼å…¥åå­—ä¸ºpreciseçš„box</span>
</span><span class='line'><span class="nv">$ </span>vagrant up
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>Copying salt minion config to vm.
</span><span class='line'>Checking <span class="k">if </span>salt-minion is installed
</span><span class='line'>salt-minion was not found.
</span><span class='line'>Checking <span class="k">if </span>salt-call is installed
</span><span class='line'>salt-call was not found.
</span><span class='line'>Bootstrapping Salt... <span class="o">(</span>this may take a <span class="k">while</span><span class="o">)</span>
</span><span class='line'>Salt successfully configured and installed!
</span><span class='line'>run_overstate <span class="nb">set </span>to false. Not running state.overstate.
</span><span class='line'>run_highstate <span class="nb">set </span>to false. Not running state.highstate.
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>vagrant ssh
</span><span class='line'><span class="nv">$ </span>sudo salt-call state.highstate
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>Summary
</span><span class='line'>-------------
</span><span class='line'>Succeeded: 11
</span><span class='line'>Failed: 0
</span><span class='line'>-------------
</span><span class='line'>Total: 11
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>è¿™é‡Œçš„è™šæ‹Ÿæœºå°†æˆ‘ä»¬åˆ›å»ºçš„æ ¹ç›®å½•<code>calamari-node</code>å’Œè™šæ‹Ÿæœºä¸­çš„<code>/git</code>ç›®å½•å…³è”èµ·æ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æŸ¥çœ‹è¿™2ä¸ªç›®å½•ä¸­çš„ä»»æ„ä¸€ä¸ªæ¥æŸ¥çœ‹å®‰è£…æ–‡ä»¶æ˜¯å¦å·²ç»ç”Ÿæˆã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># æŸ¥çœ‹calamari-nodeç›®å½•</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node
</span><span class='line'><span class="nv">$ </span>ls -l
</span><span class='line'>drwxr-xr-x  28 zhaozhiming  staff   952 Oct 20 16:16 Diamond
</span><span class='line'>drwxr-xr-x  32 zhaozhiming  staff  1088 Oct 20 16:14 calamari
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  18883769 Oct 21 15:58 calamari-repo-precise.tar.gz
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  16417474 Oct 21 15:58 calamari-server_1.2.1-68-gfdeb0f7_amd64.deb
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff    307478 Oct 21 15:58 diamond_3.4.67_all.deb
</span><span class='line'>
</span><span class='line'><span class="c"># æŸ¥çœ‹è™šæ‹Ÿæœºçš„/gitç›®å½•</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node/calamari/vagrant/precise-build
</span><span class='line'><span class="nv">$ </span>vagrant ssh
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /git
</span><span class='line'><span class="nv">$ </span>ls -l
</span><span class='line'>drwxr-xr-x  28 zhaozhiming  staff   952 Oct 20 16:16 Diamond
</span><span class='line'>drwxr-xr-x  32 zhaozhiming  staff  1088 Oct 20 16:14 calamari
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  18883769 Oct 21 15:58 calamari-repo-precise.tar.gz
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  16417474 Oct 21 15:58 calamari-server_1.2.1-68-gfdeb0f7_amd64.deb
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff    307478 Oct 21 15:58 diamond_3.4.67_all.deb
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°å®‰è£…æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½äº†ï¼Œ2ä¸ªdebæ–‡ä»¶åˆ†åˆ«æ˜¯serverå’Œç›‘æ§æœåŠ¡çš„å®‰è£…æ–‡ä»¶ï¼Œtar.gzæ–‡ä»¶æ˜¯å®‰è£…æœåŠ¡æ‰€éœ€çš„ä¾èµ–åŒ…å®‰è£…æ–‡ä»¶é›†åˆï¼Œå¦‚æœæ˜¯è¿ç½‘å®‰è£…çš„è¯ï¼Œè¿™ä¸ªtar.gzæ–‡ä»¶ä¸éœ€è¦ç”¨åˆ°ã€‚</li>
</ul>


<h3>ç”Ÿæˆclientå®‰è£…æ–‡ä»¶</h3>

<ul>
<li>ä¸‹è½½calamari-clientå·¥ç¨‹</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/ceph/calamari-clients.git
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä½¿ç”¨vagrantç”Ÿæˆclientå®‰è£…æ–‡ä»¶</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-client/vagrant/precise-build/
</span><span class='line'><span class="nv">$ </span>vagrant up
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>Copying salt minion config to vm.
</span><span class='line'>Checking <span class="k">if </span>salt-minion is installed
</span><span class='line'>salt-minion was not found.
</span><span class='line'>Checking <span class="k">if </span>salt-call is installed
</span><span class='line'>salt-call was not found.
</span><span class='line'>Bootstrapping Salt... <span class="o">(</span>this may take a <span class="k">while</span><span class="o">)</span>
</span><span class='line'>Salt successfully configured and installed!
</span><span class='line'>run_overstate <span class="nb">set </span>to false. Not running state.overstate.
</span><span class='line'>run_highstate <span class="nb">set </span>to false. Not running state.highstate.
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>vagrant ssh
</span><span class='line'><span class="nv">$ </span>sudo salt-call state.highstate
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>Summary
</span><span class='line'>-------------
</span><span class='line'>Succeeded: 13
</span><span class='line'>Failed: 0
</span><span class='line'>-------------
</span><span class='line'>Total: 13
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>æŸ¥çœ‹ç”Ÿæˆçš„å®‰è£…æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æœ‰1ä¸ªdebæ–‡ä»¶å’Œä¸€ä¸ªtar.gzæ–‡ä»¶ï¼Œubuntuçš„è¯ç›´æ¥ä½¿ç”¨debæ–‡ä»¶è¿›è¡Œå®‰è£…å°±å¯ä»¥äº†ï¼Œtar.gzæ–‡ä»¶ä¸éœ€è¦ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node
</span><span class='line'><span class="nv">$ </span>ls -l
</span><span class='line'>drwxr-xr-x  28 zhaozhiming  staff   952 Oct 20 16:16 Diamond
</span><span class='line'>drwxr-xr-x  32 zhaozhiming  staff  1088 Oct 20 16:14 calamari
</span><span class='line'>drwxr-xr-x  22 zhaozhiming  staff      748 Oct 20 16:46 calamari-clients
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  18883769 Oct 21 15:58 calamari-repo-precise.tar.gz
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff  16417474 Oct 21 15:58 calamari-server_1.2.1-68-gfdeb0f7_amd64.deb
</span><span class='line'>-rw-r--r--  1 zhaozhiming  staff    307478 Oct 21 15:58 diamond_3.4.67_all.deb
</span><span class='line'>-rw-r--r--   1 zhaozhiming  staff  1711253 Oct 21 12:38 calamari-clients-build-output.tar.gz
</span><span class='line'>-rw-r--r--   1 zhaozhiming  staff  1705364 Oct 21 12:38 calamari-clients_1.2.1.1-29-g3790c24_all.deb
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…Calamari</h2>

<ul>
<li>åˆ›å»ºä¸€ä¸ªubuntuçš„è™šæ‹Ÿæœºæ¥å®‰è£…calamariï¼Œé¦–å…ˆåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªVagrantfileæ–‡ä»¶ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>calamari-node
</span><span class='line'><span class="nv">$ </span>touch Vagrantfile
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Vagrantfileæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œæ³¨æ„è¦ä½¿ç”¨ç»‘å®šå¥½çš„IPã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;precise64&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;manager&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">manager</span><span class="o">|</span>
</span><span class='line'>    <span class="n">manager</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;manager-env&quot;</span>
</span><span class='line'>    <span class="n">manager</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.26.10&quot;</span>
</span><span class='line'>    <span class="n">manager</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span class='line'>      <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="mi">512</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å¯åŠ¨è™šæ‹Ÿæœºå¹¶ç™»é™†</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vagrant up
</span><span class='line'><span class="nv">$ </span>vagrant ssh
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…salt</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo apt-get install python-software-properties
</span><span class='line'><span class="nv">$ </span>sudo add-apt-repository ppa:saltstack/salt
</span><span class='line'><span class="nv">$ </span>sudo apt-get update
</span><span class='line'><span class="nv">$ </span>sudo apt-get install salt-master
</span><span class='line'><span class="nv">$ </span>sudo apt-get install salt-minion
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…æ‰€éœ€ä¾èµ–åŒ…</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get install -y apache2 libapache2-mod-wsgi libcairo2 supervisor python-cairo libpq5 postgresql
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å®‰è£…calamari</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /vagrant
</span><span class='line'><span class="nv">$ </span>sudo dpkg -i calamari-server*.deb calamari-clients*.deb
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åˆå§‹åŒ–calamariæœåŠ¡ï¼Œè¿™é‡Œä¼šè¦æ±‚ä½ è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ï¼Œè¿™ä¸ªç”¨æˆ·åå¯†ç æ˜¯åœ¨æµè§ˆå™¨è®¿é—®calamariæœåŠ¡éœ€è¦çš„ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo calamari-ctl initialize
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Loading configuration..
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Starting/enabling salt...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Starting/enabling postgres...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Initializing database...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Initializing web interface...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> You will now be prompted <span class="k">for </span>login details <span class="k">for </span>the administrative user account. This is the account you will use to log into the web interface once setup is complete.
</span><span class='line'>Username <span class="o">(</span>leave blank to use <span class="s1">&#39;root&#39;</span><span class="o">)</span>:
</span><span class='line'>Email address: karan.singh@csc.fi
</span><span class='line'>Password:
</span><span class='line'>Password <span class="o">(</span>again<span class="o">)</span>:
</span><span class='line'>Superuser created successfully.
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Starting/enabling services...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Restarting services... - See more at: http://ceph.com/category/calamari/#sthash.qUtbU0mX.dpuf
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ç™»é™†æµè§ˆå™¨ï¼Œè¾“å…¥è™šæ‹Ÿæœºçš„ip(æ¯”å¦‚<a href="http://192.168.26.10">http://192.168.26.10</a>)ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ã€‚</li>
</ul>


<p><img src="/images/post/2014-10/calamari-login.png"></p>

<ul>
<li>è¾“å…¥åˆšæ‰è®¾ç½®çš„ç”¨æˆ·åå¯†ç åï¼Œå¯ä»¥çœ‹åˆ°calamariæç¤ºä½ è¿›è¡Œcephé›†ç¾¤é…ç½®ã€‚</li>
</ul>


<p><img src="/images/post/2014-10/calamari-first.png"></p>

<h2>Cephé›†ç¾¤é…ç½®ç›‘æ§æœåŠ¡</h2>

<h3>é…ç½®cephé›†ç¾¤</h3>

<ul>
<li>ç™»é™†å…¶ä¸­ä¸€å°cephé›†ç¾¤æœºå™¨(è¿™é‡Œå‡è®¾cephé›†ç¾¤éƒ½æ˜¯ubuntuç¯å¢ƒ)ï¼Œå®‰è£…ç›‘æ§æœåŠ¡ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo dpkg -i diamond_3.4.67_all.deb <span class="c">#debæ–‡ä»¶æ˜¯ä¹‹å‰ç”Ÿæˆserverå®‰è£…æ–‡ä»¶æ—¶ä¸€èµ·ç”Ÿæˆçš„ï¼Œéœ€è¦å°†å…¶å…ˆè€ƒåˆ°cephé›†ç¾¤æœºå™¨ä¸Š</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åˆ›å»ºé»˜è®¤çš„ç›‘æ§é…ç½®æ–‡ä»¶</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo mv /etc/diamond/diamond.conf.example /etc/diamond/diamond.conf
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å®‰è£…salt-minionæœåŠ¡</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo apt-get install python-software-properties
</span><span class='line'><span class="nv">$ </span>sudo add-apt-repository ppa:saltstack/salt
</span><span class='line'><span class="nv">$ </span>sudo apt-get update
</span><span class='line'><span class="nv">$ </span>sudo apt-get install salt-minion
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨<code>/etc/hosts</code>æ–‡ä»¶ä¸­å¢åŠ calamariæœåŠ¡å™¨çš„æ˜ å°„å…³ç³»</li>
</ul>


<figure class='code'><figcaption><span>/etc/hosts </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>...
</span><span class='line'>...
</span><span class='line'>192.168.26.10 ceph-calamari
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä¿®æ”¹salt-minionçš„é…ç½®æ–‡ä»¶<code>/etc/salt/minion</code>ï¼Œå°†masteræŒ‡å‘calamariæœåŠ¡å™¨</li>
</ul>


<figure class='code'><figcaption><span>/etc/salt/minion </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>...
</span><span class='line'>master: ceph-calamari
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>é‡å¯æœåŠ¡</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo service salt-minion restart
</span><span class='line'><span class="nv">$ </span>sudo service diamond restart
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨æ‰€æœ‰çš„cephé›†ç¾¤æœºå™¨ä¸Šé‡å¤ä»¥ä¸Šçš„æ­¥éª¤ã€‚</li>
</ul>


<h3>åœ¨calamariæœåŠ¡ä¸Šæ·»åŠ cephé›†ç¾¤æœºå™¨</h3>

<ul>
<li>æŸ¥çœ‹salt-key</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo salt-key -L
</span><span class='line'>Accepted Keys:
</span><span class='line'>Unaccepted Keys:
</span><span class='line'>ceph-mon0
</span><span class='line'>ceph-mon1
</span><span class='line'>ceph-mon2
</span><span class='line'>ceph-osd0
</span><span class='line'>ceph-osd1
</span><span class='line'>ceph-osd2
</span><span class='line'>Rejected Keys:
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>æ·»åŠ cephé›†ç¾¤æœºå™¨åˆ°calamari</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo salt-key -A
</span><span class='line'>The following keys are going to be accepted:
</span><span class='line'>Unaccepted Keys:
</span><span class='line'>ceph-mon0
</span><span class='line'>ceph-mon1
</span><span class='line'>ceph-mon2
</span><span class='line'>ceph-osd0
</span><span class='line'>ceph-osd1
</span><span class='line'>ceph-osd2
</span><span class='line'>Proceed? <span class="o">[</span>n/Y<span class="o">]</span> y
</span><span class='line'>Key <span class="k">for </span>minion ceph-mon0 accepted.
</span><span class='line'>Key <span class="k">for </span>minion ceph-mon1 accepted.
</span><span class='line'>Key <span class="k">for </span>minion ceph-mon2 accepted.
</span><span class='line'>Key <span class="k">for </span>minion ceph-osd0 accepted.
</span><span class='line'>Key <span class="k">for </span>minion ceph-osd1 accepted.
</span><span class='line'>Key <span class="k">for </span>minion ceph-osd2 accepted.
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å†æ¬¡æŸ¥çœ‹salt-keyï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²æ·»åŠ ã€‚</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo salt-key -L
</span><span class='line'>Accepted Keys:
</span><span class='line'>ceph-mon0
</span><span class='line'>ceph-mon1
</span><span class='line'>ceph-mon2
</span><span class='line'>ceph-osd0
</span><span class='line'>ceph-osd1
</span><span class='line'>ceph-osd2
</span><span class='line'>Unaccepted Keys:
</span><span class='line'>Rejected Keys:
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨æµè§ˆå™¨ä¸­å†æ¬¡ç™»é™†calamariæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»èƒ½ç›‘æ§cephé›†ç¾¤çš„ä¿¡æ¯ã€‚</li>
</ul>


<p><img src="/images/post/2014-10/calamari.png"></p>

<p><img src="/images/post/2014-10/calamari-page1.png"></p>

<p><img src="/images/post/2014-10/calamari-page2.png"></p>

<p><img src="/images/post/2014-10/calamari-page3.png"></p>

<h2>å‚è€ƒèµ„æ–™</h2>

<ul>
<li>æ–‡æ¡£1ï¼š<a href="http://calamari.readthedocs.org/en/latest/operations/index.html">http://calamari.readthedocs.org/en/latest/operations/index.html</a></li>
<li>æ–‡æ¡£2ï¼š<a href="http://calamari.readthedocs.org/en/latest/operations/index.html">http://ceph.com/category/calamari/</a></li>
</ul>

</div>

<div class="meta">
</div>
</article>
  <section id="appreciates">
    <center>
	    <h2>èµèµ</h2>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥è½¬ç‚¹ ETH ç»™æˆ‘å–å’–å•¡ğŸ˜Œï¼Œé’±åŒ…äºŒç»´ç ï¼š</h4>
      <span>0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</span>
      <img src="/images/my_eth_qrcode.png" alt="qrcode" width="250" >
    </center>
  </section>
	
		<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

	
	
	<section id="comment">
	    <h2 class="title">Comments</h2>
	    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
	</section>
	
</div>

	    </div>
	    <footer id="footer">
	    <div style="display:inline">
    Copyright &copy; 2018

    èµµèŠæ˜
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


	    </footer>
	    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'zhaozhiming';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://zhaozhiming.github.io/blog/2014/10/28/install-ceph-calamari-on-ubuntu/';
        var disqus_url = 'http://zhaozhiming.github.io/blog/2014/10/28/install-ceph-calamari-on-ubuntu/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




	</div>
	
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
