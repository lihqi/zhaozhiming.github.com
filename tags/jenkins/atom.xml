<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: jenkins | Hacker and Geeker's Way]]></title>
  <link href="http://zhaozhiming.github.io/tags/jenkins/atom.xml" rel="self"/>
  <link href="http://zhaozhiming.github.io/"/>
  <updated>2013-08-21T18:32:39+08:00</updated>
  <id>http://zhaozhiming.github.io/</id>
  <author>
    <name><![CDATA[赵芝明]]></name>
    <email><![CDATA[kingzzm1982@sina.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[jenkins无法读取覆盖率报告的解决方法]]></title>
    <link href="http://zhaozhiming.github.io/blog/2012/06/19/the-way-for-read-coverage-report-in-jenkins/"/>
    <updated>2012-06-19T16:01:00+08:00</updated>
    <id>http://zhaozhiming.github.io/blog/2012/06/19/the-way-for-read-coverage-report-in-jenkins</id>
    <content type="html"><![CDATA[<p>报错信息如下：</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>log </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>coverage-report:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;[mkdir] Created dir: D:\JK\workspace\d9_rm3_engine_dev1.0.0_cud\view\rmv3_engine\engine_j2ee\doc\coveragereport&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;[cobertura-report] Cobertura 1.9.4.1 &amp;ndash; GNU GPL License (NO WARRANTY) &amp;ndash; See COPYRIGHT file&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;[cobertura-report] Cobertura: Loaded information on 114 classes.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;[cobertura-report] Report time: 913ms&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;BUILD SUCCESSFUL&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Total time: 1 minute 44 seconds&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Publishing Cobertura coverage report&amp;hellip;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;No coverage results were found using the pattern &amp;lsquo;view/rmv3_engine/engine_j2ee/doc/coveragereport/coverage.xml&amp;rsquo; relative to &amp;rsquo;D:\JK\workspace\d9_rm3_engine_dev1.0.0_cud\view&#39;.  Did you enter a pattern relative to the correct directory?  Did you generate the XML report(s) for Cobertura?&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Build step &amp;lsquo;Publish Cobertura Coverage Report&amp;rsquo; changed build result to FAILURE&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Recording test results&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Finished: FAILURE
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>覆盖率报告已经生成，在工作区也可以找到，路径是：'view/rmv3_engine/engine_j2ee/doc/coveragereport/coverage.xml'，但jenkins对于这个路径似乎不认，以前用svn的时候可以找到，改成CC后就找不到了。</p>

<p>解决方法：job配置里面将覆盖率的路径设置为：/coverage.xml 就可以了。很奇怪的一个问题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jenkins的2个问题]]></title>
    <link href="http://zhaozhiming.github.io/blog/2012/05/21/2-problems-when-update-jenkins/"/>
    <updated>2012-05-21T15:52:00+08:00</updated>
    <id>http://zhaozhiming.github.io/blog/2012/05/21/2-problems-when-update-jenkins</id>
    <content type="html"><![CDATA[<p>最近CI服务器从老版本的hudson升级为jenkins，遇到了2个问题，记录一下：</p>

<p><strong>1.升级为jenkins后，junit report里面显示的test case数量为原来的两倍，每个test case跑了2遍。</strong></p>

<p>在job设置的junit文件路径提示这样写：'myproject/target/test-reports/*.xml'，老的hudson版本只会读取TEST-*.xml文件，而新的jenkins不仅会读取所有TEST-*.xml，还会读取TESTS-TestSuites.xml文件，而这个文件是包含了前面的Test-*.xml里面的test case的，所以会显示为两倍。</p>

<p>解决方案是:junit文件路径这样写：'myproject/target/test-reports/TEST-*.xml'，这样就不会包含TESTS-TestSuites.xml文件了。</p>

<p>官网上已经有人建议job配置的提示要改一下，但不知道jenkins以后会在哪个版本改（也有可能不会改:(）。</p>

<p><strong>2.jenkins没有在build之前清空工作区的选项。</strong></p>

<p>老的hudson版本的job设置里Advanced Project Options下有个选项是Clean workspace before build，即在build之前清空workspace里面的内容，而jenkins里面没有这个选项。</p>

<p>那如何实现在build前情况workspace呢？<br/>
可以在Source Code Management里面进行配置，一般的版本管理工具（git, svn）都可以配置Check-out Strategy，例如SVN， 选择Always check out a fresh copy，这个策略的意思是:</p>

<p><blockquote><p>Delete everything first, then perform &ldquo;svn checkout&rdquo;. While this takes time to execute, it ensures that the workspace is in the pristine state.</p></blockquote></p>

<p>这样就实现了build前清空workspace的效果了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用emma时遇到的一些问题]]></title>
    <link href="http://zhaozhiming.github.io/blog/2012/03/27/some-problems-in-emma/"/>
    <updated>2012-03-27T22:05:00+08:00</updated>
    <id>http://zhaozhiming.github.io/blog/2012/03/27/some-problems-in-emma</id>
    <content type="html"><![CDATA[<p>今天在用使用emma的过程中遇到了几个问题，记录一下.</p>

<p><strong>1.跑junit过程中没办法产生coverage data文件，导致最后没办法出emma报告，上官网查了一下原因如下：</strong>  <br/>
<blockquote><p>I have instrumented my classes but am not getting any coverage data&hellip; <br/><br/>This question has been asked several times and in all cases the users forgot to package or deploy the instrumented versions of their classes. Please check that your build places EMMA-instrumented classes ahead of the normal application classpath at runtime.</p></blockquote>
意思是emma会根据工程里面的class文件产生自己的instrumented class，junit在跑单元测试的时候，classpath要把定义emma的class文件路径放在项目class文件路径前面，才能产生coverage data文件。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;junit</span> <span class="err">...</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;classpath</span> <span class="na">location=</span><span class="s">&quot;${emma.classes.dir}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;classpath</span> <span class="na">location=</span><span class="s">&quot;${project.classes.dir}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="ni">&amp;hellip;</span>
</span><span class='line'><span class="nt">&lt;/junit&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>2.emma的示例代码里面，report的sourcepath属性只有一个src路径，如果项目里面有多个src路径同时要进行覆盖率检查的话，则需要这样写：</strong></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;report</span> <span class="na">sourcepath=</span><span class="s">&quot;${src1};${src2};${src3}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>   <span class="ni">&amp;hellip;</span>
</span><span class='line'><span class="nt">&lt;/report&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div><br/>
不同的src路径用操作系统的classpath分隔符或逗号隔开，比如window用分号隔开，官网是这样解释的：<br/>
<blockquote><p>sourcepath : An optional source path to use for report generation (a path-like structure). It is interpreted as a list of directories (separated by the OS-specific classpath separator or comma) containing .java source files. The local path names within each directory should reflect class package names. (Currently, only the HTML report generator uses this data, and only atmethod report depth.)</p></blockquote></p>

<p><strong>3.jenkins的emma插件可以显示覆盖率的趋势，已经包，类，方法的覆盖率情况，但不支持链接显示代码源文件，看了下jenkins的官网，有人已经对插件提了这样一个需求，但回复说无法实现，说明如下：</strong>  <br/>
<blockquote><p>This was an obvious feature and so I tried to do this, but the problem is that the HTML file names and anchors that EMMA puts are just random numbers. So Hudson cannot link to the appropriate portion of those HTML files.</p></p><p><p>I also thought about generating those reports by myself in Hudson, but EMMA doesn&rsquo;t leave the line-by-line coverage information in XML file either.</p></p><p><p>So that leaves me no choice but to parse emma&rsquo;s data file directly. So this is bit involving.　　</p></blockquote></p>

<p>意思是说emma的html源文件是用随机数字命名，所以在xml文件中无法链接这些html源文件，emma没有修复这个问题，插件作者也无法完成这个需求:(</p>

<p>我的解决方案是用doc link插件在jenkins页面上直接链接coverage.html文件。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[bat脚本:通过端口号查找进程号]]></title>
    <link href="http://zhaozhiming.github.io/blog/2012/03/26/find-the-process-id-thought-port-in-bat-script/"/>
    <updated>2012-03-26T22:51:00+08:00</updated>
    <id>http://zhaozhiming.github.io/blog/2012/03/26/find-the-process-id-thought-port-in-bat-script</id>
    <content type="html"><![CDATA[<p>最近在用jenkins做自动化web部署，web服务器是tomcat。</p>

<p>遇到了这样一个问题：在服务器上执行tomcat的shutdown.bat命令可以正常关机，但用jenkins执行shutdown.bat命令时却经常关闭不了，从而导致重启时报错。后来想到了杀进程的办法来关闭tomcat服务器，但是要怎样才能查到tomcat进程并杀掉呢？</p>

<p>下面是通过端口号查找进程的命令：<br/>
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>netstat -ano <span class="p">|</span> <span class="n">findstr</span> <span class="m">8888</span> <span class="n">//我的tomcat端口给我改成8888了。</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>查出来的结果好像这样：TCP    0.0.0.0:8888           0.0.0.0:0              LISTENING       1844<br/>
其中最后一项是进程号（PID），要怎么取到PID并杀掉进程呢？</p>

<p>可以使用for语句来操作，for默认是以空格或tab为分割，即上面的结果会分割成5个部分，而pid正好是第5部分的内容，所以命令可以这样写：<br/>
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="k">for</span> <span class="n">/f</span> &amp;ldquo;tokens<span class="o">=</span><span class="m">5</span>&amp;rdquo; <span class="nv">%%i</span> in (&amp;ldquo;netstat -ano <span class="p">|</span> <span class="n">findstr</span> <span class="m">8888</span>&amp;rdquo;) <span class="k">do</span> taskkill <span class="n">/f</span> <span class="n">/pid</span> <span class="nv">%%i</span> <span class="n">/t</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>taskkill命令是杀进程的，/f表示强制进行，/t表示将其子进程一并杀掉。</p>

<p>这样就不怕tomcat服务关不掉了，重启也正常了，自动化部署成功。</p>
]]></content>
  </entry>
  
</feed>
